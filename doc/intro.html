<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="stylesheet" href="theme/face/face.css">
<meta name="keywords" content="">
<meta name="description" content="指引">
<title>指引</title>
<!--[if lt IE 10]><script src="theme/polyfill/lt-ie10.js"></script><![endif]-->
<script src="theme/polyfill/es6-promise.js"></script>
</head>
<body>
<div class="face-one-head">
    <a class="face-one-head-logo" href="../index.html">
        <img src="theme/media/logo.svg" alt="" class="face-one-head-logo-photo" />
        <span class="face-one-head-logo-text">
        react-defaultvalue
        </span>
    </a>
    <span class="face-one-head-slogan">
        Write less code, do more things!
    </span>
    <!-- <div class="face-one-head-search">
        <span class="face-one-head-search-icon fi fi-search"></span>
        <input type="text" class="face-one-head-search-input" placeholder="搜索..." />
    </div> -->
    <div class="face-one-head-nav">
        <span class="face-one-head-nav-switch fi fi-bars"></span>
        <div class="face-one-head-nav-F-cnt">
            <a href="../index.html" class="face-one-head-nav-link">首页</a>
            <a href="intro.html" class="face-one-head-nav-link">指引</a>
            <a href="index.html" class="face-one-head-nav-link">文档</a>
        </div>
        <script>
        Array.from(document.querySelectorAll('.face-one-head-nav-link')).forEach(function (node) {
            if (node.href) {
                var pathname = node.href.replace(/\?.*/, '')
                if (pathname === location.origin + location.pathname) {
                    node.setAttribute('class', node.getAttribute('class') + ' ' + 'face-one-head-nav-link--on')
                }
            }
        })
        </script>
    </div>
</div>

<div class="face-one-layout">
<div class="face-one-layout-F-line">
<div class="face-one-layout-sidebar">
<div class="face-one-nav">
<span class="face-one-nav-switch fi fi-menu-unfold"></span>
<div class="face-one-nav-F-inner">
<div class="face-one-nav-item">
    <a href="intro.html" class="face-one-nav-item-label">指引</a>
</div>
<div class="face-one-nav-item">
    <a href="index.html" class="face-one-nav-item-label">文档</a>
</div>
<!-- face-one-nav-item--group-on 控制默认展开 -->
<!-- <div class="face-one-nav-item face-one-nav-item--group face-one-nav-item--group-on">
    <span class="face-one-nav-item-switch fi fi-down"></span>
    <span class="face-one-nav-item-label">
        文档
    </span>
    <div class="face-one-nav-item-group">
        <div class="face-one-nav-item-group-title">示例</div>
        <a href="index.html#style" class="face-one-nav-item-group-item">颜色</a>
        <a href="index.html#border" class="face-one-nav-item-group-item">边框</a>
    </div>
    <div class="face-one-nav-item-group">
        <div class="face-one-nav-item-group-title">自定义界面</div>
        <a href="index.html#less" class="face-one-nav-item-group-item">less</a>
    </div>
</div> -->

</div>
</div>
</div>
<div class="face-one-layout-cnt">
<div id="face-one-cnt" class="face-one-cnt markdown-body">
<div id="face-one-sidebar" class="face-one-sidebar"></div>
<h1 id="指引" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#指引"><span class="markrun-anchor-link"></span></a>指引</h1><blockquote>
<p>使用一个组件或模块之前，应当知道它能解决的问题是什么，不能解决的问题是什么。使用的最佳实践是什么？</p>
</blockquote>
<h2 id="非受控组件" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#非受控组件"><span class="markrun-anchor-link"></span></a>非受控组件</h2><p>React 提供的<a href="https://doc.react-china.org/docs/uncontrolled-components.html">非受控组件</a> 通过 <code>defaultValue</code> 控制表单的默认值。搜索</p>
<p>这是个很棒的方式，因为我们并不需要在任何时候都配置表单控件的 <code>value</code> 和 <code>onChange</code>。</p>
<p>但是我们自己实现的组件想支持非受控组件就需要自己实现 <code>defaultValue</code> 。比如实现一个点击会递增的 <code>Button</code>。</p>
<h2 id="受控的按钮" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#受控的按钮"><span class="markrun-anchor-link"></span></a>受控的按钮</h2>
    <div class="face-one-code   face-one-code--run ">
                        <div class="face-one-code-F-view">
                            <div class="face-one-code-example">
                                <div id="intro-button-demo" ></div>
                            </div>
                            <div class="face-one-code-info">
                                <div class="face-one-code-info-title">受控的按钮</div>
                                <div class="face-one-code-info-desc">
                                    <p><code>&lt;Button value={self.state.value} onChange={function(){...}} /&gt;</code></p>
                                </div>
                                <span class="face-one-code-info-switchCode fi fi-code"></span>
                            </div>
                        </div>
                        <div class="face-one-code-source"  >
                            <div class="face-one-code-source-tool">
                                <form class="face-one-code-source-tool-preview" action="https://codesandbox.io/api/v1/sandboxes/define" method="post" target="_blank" >
                                    <input type="hidden" name="parameters" value="N4IgZglgNgpgziAXKCA7AJjAHgOgBYAuAtlEqAMYD2qBMNSIAPOhAG4AEE6AvADohoCAJ0oBaAEYBXAgWqjMRSv3YA-RgHoWrFSAC-AGgEZsOAFYJkIKjToEGEIgAdKQguwBKMAIbkCAEQB5AFl2MBEidn4hb195SiJ-XlQHZ1cPGLd9dmB2AGF451Rbdl1Q8MiQaJ8CRNRyKC84OHYAIWlZVHZsWgxm_KdqYuAk9lH2azhhSV8XdgAKRxFHOABKbJGxzbhJRxghBaXVjc3Ribc4GCgwdm52AjwIOGOTi6ucSa9aG_XOk7_WLxQSQwRDsRaUZY4TBgLySKAEABqgOBz02ume6N-o2ixn2a2GWJOZ3Yr2ut3uj1RY2iBEkQk6cypf0YUhk1CZfzG1FyUAg5AA1txgHM1twVD9OZKThBrnMCABPXaUa6knDgyHcvBeVAAcxgN24twA5GBJHUCBBqEb8RypZzVeq4DhNdq9XMHYccACgfqANTsACMK1tdpKIbtlwuEtDMdVFwIAGUCJ8YHNgN7gaC48naF7kX7A7pg4SY2jwyddJiYypy5tgB6IU6M_qAD4tkmXMDvHMwPM-quhjSsjo1ktjYtl1CY-qNZp-GCKLpYHroPoFQY0aOnaiTITTWRCeaOm1j0bbXb7Y8c4mk74Up6njtvD5fW4EmPN0EBgAMHIHo3_dgcUwPEtyJHdzk7O8HgfSUaTpBly0YNo2VQWsxmbIVsxTPtgUAmMXV1GAhVNc1LQZZsT1Le1O3eGBEx7NNP3YZsi3QgD8MldRR0lCcxkxTEkiSTxqkCIIcGAvZGUJRh50Xbj9GedBKHISQiFsHA9QIABRWB1JoFp5QASXQOYjUEEQJHaOQFEoa0kmLPRDEcHx-S8PUzDgagyCsagejsSxMF2Yw6ggeAfLgLwwBgURujodAGAAPQAZhwb8cAAVhAQxpGgCSMiSgMcAANjS7LKgKxAQESgNSoAFjKwwqliZSiEK-rGoq6p5BgGE4QIZsGHSgAmMrK3GoA">
                                    <button type="submit" class="fi fi-edit face-one-code-source-tool-preview-submit" ></button>
                                </form>
                                <span class="face-one-code-source-tool-copy fi fi-copy"></span>
                            </div>
                            <pre><code class="lang-js">import ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>
import React , { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
class Button extends Component {
    constructor (props) {
        super(props)
        const <span class="hljs-literal">self</span> = this
        <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span> = {
            value: props.<span class="hljs-keyword">default</span>Value
        }
    }
    render() {
        const <span class="hljs-literal">self</span> = this
        return (
            <span class="hljs-variable">&lt;button
                onClick={() =&gt;</span> {
                    if (typeof <span class="hljs-literal">self</span>.props.<span class="hljs-keyword">on</span>Change === 'function') {
                        <span class="hljs-literal">self</span>.props.<span class="hljs-keyword">on</span>Change(<span class="hljs-literal">self</span>.props.value + <span class="hljs-number">1</span>)
                    }
                    else {
                        <span class="hljs-literal">self</span>.<span class="hljs-built_in">set</span>State({value: <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value + <span class="hljs-number">1</span>})
                    }
                }}
            &gt;
                {<span class="hljs-literal">self</span>.props.value || <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value}
            &lt;/button&gt;
        )
    }
}
class Demo extends Component {
    constructor (props) {
        super(props)
        const <span class="hljs-literal">self</span> = this
        <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span> = {
            value: <span class="hljs-number">10</span>
        }
    }
    render() {
        const <span class="hljs-literal">self</span> = this
        return (
            <span class="hljs-variable">&lt;Button
                value={self.state.value}
                onChange={function (value) {
                    self.setState({value: value})
                }}
             /&gt;</span>
        )
    }
}


ReactDOM.render(
    <span class="hljs-variable">&lt;Demo /&gt;</span>,
    document.getElementById('intro-button-demo')
)

</code></pre>
                        </div>
                        
                    </div>
                                
<h2 id="非受控的按钮" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#非受控的按钮"><span class="markrun-anchor-link"></span></a>非受控的按钮</h2>
    <div class="face-one-code   face-one-code--run ">
                        <div class="face-one-code-F-view">
                            <div class="face-one-code-example">
                                <div id="intro-defaultValue-demo" ></div>
                            </div>
                            <div class="face-one-code-info">
                                <div class="face-one-code-info-title">非受控的按钮</div>
                                <div class="face-one-code-info-desc">
                                    <p><code>&lt;Button defaultValue={20} /&gt;</code></p>
                                </div>
                                <span class="face-one-code-info-switchCode fi fi-code"></span>
                            </div>
                        </div>
                        <div class="face-one-code-source"  >
                            <div class="face-one-code-source-tool">
                                <form class="face-one-code-source-tool-preview" action="https://codesandbox.io/api/v1/sandboxes/define" method="post" target="_blank" >
                                    <input type="hidden" name="parameters" value="N4IgZglgNgpgziAXKCA7AJjAHgOgBYAuAtlEqAMYD2qBMNSIAPOhAG4AEE6AvADohoCAJ0oBaTGACGAVygEAapKjSY4mEUr92APkYB6Fq20gAvgBoBGbDgBWCZCCo06BBhCIAHSkILsASjCS5AQAIgDyALLsYCJE7PxCgcHilET8vKjuXj7-Sb5m7MDsAMKpXqgu7CbRsfEgiUEE6ajkUJJwcOwAQtIEBNTs2LQYnaWe1JXAGewz7E5wwtLB3uwAFB4iHnAAlIXTswdw0h4wQuubO_sHM_O-cDBQYOzc7AR4EHBX1_ePOAuStGee1Q11B7FYShUiHYG0oWxwEhkckUyhgXwOJi-mJBs0SVjOuymONBt3YPyeLzeH3RuJgBGkQhBqxpoMYACNev1UCywTNqMUoBByABrbjAVa7bjaYG82WzCBPVYEACeJ0oT3JOFh8P5eEkqAA5jBntwXgByaRWSAVdBmwk8uWgzX3AgAZQIAJgq2AENR0OdHtoOF9KnYAGp2ABGEzbB2O7GO2UPe4yxOOzXauA4XX6o2rDMXYOQ40RyOx4lpjFx0EmBOO7TV65EyuglVqjUPMBawsh40AQlN7AtVrQMFtAH5G7yC3Cs73EFOwQHPUXUYuZnW5foOX1qA2Kwdy1XUNiMhkAo1whEcHjMGcvsyD7NGD1dyDEbIFMWxQAmAAM1R6Puh5mF86CUOQ0hEC4OBGgQACisDQTQXTKgAkugqxmoIIhqFIn4oioagaHaGTlqYFgeEEwqSEathwNQZCONQwyuA4mAnFYLQQPATFwJIYCqEMdDoAwAB6ADMOB_jgACsIAWL00A3nk4mRjgABs0kKfUqmICAYmRlpAAs2kWA0yTgUQakmWZumNHhSIEL2DAyT-2m1p5QA">
                                    <button type="submit" class="fi fi-edit face-one-code-source-tool-preview-submit" ></button>
                                </form>
                                <span class="face-one-code-source-tool-copy fi fi-copy"></span>
                            </div>
                            <pre><code class="lang-js">import ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>
import React , { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
class Button extends Component {
    constructor (props) {
        super(props)
        const <span class="hljs-literal">self</span> = this
        <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span> = {
            value: props.<span class="hljs-keyword">default</span>Value
        }
    }
    render() {
        const <span class="hljs-literal">self</span> = this
        return (
            <span class="hljs-variable">&lt;button
                onClick={() =&gt;</span> {
                    if (typeof <span class="hljs-literal">self</span>.props.<span class="hljs-keyword">on</span>Change === 'undefined') {
                        <span class="hljs-literal">self</span>.<span class="hljs-built_in">set</span>State({value: <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value + <span class="hljs-number">1</span>})
                    }
                    else {
                        <span class="hljs-literal">self</span>.props.<span class="hljs-keyword">on</span>Change(<span class="hljs-literal">self</span>.props.value + <span class="hljs-number">1</span>)
                    }
                }}
            &gt;
                {
                    typeof <span class="hljs-literal">self</span>.props.value !== 'undefined'?
                    <span class="hljs-literal">self</span>.props.value:
                    <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value
                }
            &lt;/button&gt;
        )
    }
}


ReactDOM.render(
    (
        <span class="hljs-variable">&lt;Button defaultValue={20} /&gt;</span>
    ),
    document.getElementById('intro-defaultValue-demo')
)

</code></pre>
                        </div>
                        
                    </div>
                                
<h2 id="如何实现 <code>defaultValue</code>" ><a class="markrun-anchor" href=../Users/nimo/Documents/git/react-defaultvalue/"#如何实现 <code>defaultValue</code>"><span class="markrun-anchor-link"></span></a>如何实现 <code>defaultValue</code></h2><p>比较两段代码的区别后可以发现支持 <code>defaultValue</code> 需要加上</p>
<ol>
<li>组件内部状态默认为 defaultValue</li>
</ol>
<pre><code class="lang-diff"><span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span> = {
   value: props.<span class="hljs-keyword">default</span>Value
}
</code></pre>
<ol start="2">
<li><code>props.onChange === undefined</code> 时修改组件内部状态</li>
</ol>
<pre><code class="lang-js">if (typeof <span class="hljs-literal">self</span>.props.<span class="hljs-keyword">on</span>Change === 'undefined') {
    <span class="hljs-literal">self</span>.<span class="hljs-built_in">set</span>State({value: <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value + <span class="hljs-number">1</span>})
}
</code></pre>
<ol start="3">
<li><code>props.value</code> 不存在时使用组件内部状态</li>
</ol>
<pre><code class="lang-js">{
    typeof <span class="hljs-literal">self</span>.props.value !== 'undefined'?
    <span class="hljs-literal">self</span>.props.value:
    <span class="hljs-literal">self</span>.<span class="hljs-keyword">state</span>.value
}
</code></pre>
<p>修改的代码量不大，你甚至可以将第二段代码作为实现 <code>defaultValue</code> 的教程。</p>
<h2 id="简练代码实现丰富功能" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#简练代码实现丰富功能"><span class="markrun-anchor-link"></span></a>简练代码实现丰富功能</h2><p>但是如果你需要开发很多组件，例如 <a href="https://onface.live/">onface</a> 团队要维护 <a href="https://onface.live/react.html">大量的 react 组件</a> 重复写 <code>defaultValue</code> 代码会变得很枯燥。</p>
<p>有些组件的 <a href="http://onface.live/component-spec/react/input-output.html">输入输出</a>接口比较另类。比如：</p>
<p>输出 <code>onMount</code></p>
<pre><code class="lang-js"><span class="hljs-tag">&lt;<span class="hljs-name">Count</span>
    <span class="hljs-attr">value</span>=<span class="hljs-string">{self.state.age}</span>
    <span class="hljs-attr">onMount</span>=<span class="hljs-string">{self.handleChange}</span>
/&gt;</span>
</code></pre>
<p>输入 <code>show</code></p>
<pre><code class="lang-js"><span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span>
    <span class="hljs-attr">show</span>=<span class="hljs-string">{self.state.tip}</span>
    <span class="hljs-attr">onChange</span>=<span class="hljs-string">{self.handleChange}</span>
/&gt;</span>
</code></pre>
<p>标准的输入输出应该是</p>
<pre><code class="lang-js">&lt;<span class="hljs-selector-tag">input</span>
    value={self<span class="hljs-selector-class">.state</span><span class="hljs-selector-class">.name</span>}
    onChange={self.handleChange}
/&gt;
</code></pre>
<p>这些情况下刚才所展示的代码就需要做很多修改。枯燥是不枯燥了，不同组件每次都实现不同的 <code>defaultValue</code> 会变得很繁琐。</p>
<blockquote>
<p><code>Tooltip</code> 的输入是 <code>show</code> 是完全合理的，不同于表单控件输入是<code>value</code>。</p>
</blockquote>
<h2 id="react-defaultvalue" ><a class="markrun-anchor" href="../Users/nimo/Documents/git/react-defaultvalue/#react-defaultvalue"><span class="markrun-anchor-link"></span></a>react-defaultvalue</h2><p>使用 <a href="http://onface.live/react-defaultvalue">react-defaultvalue</a> 能快速优雅的解决这些问题。</p>
<pre><code class="lang-js">/*
    &lt;Count
        <span class="hljs-keyword">value</span>={self.state.age}
        onMount={self.handleChange}
    /&gt;
*/
Count = require(<span class="hljs-string">'react-defaultvalue'</span>)(Count, {
    output: <span class="hljs-string">'onMount'</span>
})
</code></pre>
<pre><code class="lang-js"><span class="hljs-tag">&lt;<span class="hljs-name">Count</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{20}</span> /&gt;</span>
</code></pre>
<pre><code class="lang-js"><span class="hljs-comment">/*
    &lt;Tooltip
        show={self.state.tip}
        onChange={self.handleChange}
    /&gt;
*/</span>
Tooltip = require(<span class="hljs-string">'react-defaultvalue'</span>)(Tooltip, {
    <span class="hljs-selector-tag">input</span>: <span class="hljs-string">'show'</span>
})
</code></pre>
<pre><code class="lang-js"><span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">defaultShow</span>=<span class="hljs-string">{true}</span> /&gt;</span>
</code></pre>
<p><strong><a href="./index.html">更多使用方法</a></strong></p></div>
</div>
</div>
</div>
<script>
Array.from(document.querySelectorAll('.face-one-nav-item-label')).forEach(function (node) {
    if (node.href) {
        var pathname = node.href.replace(/\?.*/, '')
        if (pathname === location.origin + location.pathname + location.hash) {
            node.setAttribute('class', node.getAttribute('class') + ' ' + 'face-one-nav-item-label--on')
        }
    }
})
var faceOneGetParent = function faceOneGetParent (el, className) {
   if (el.parentNode.nodeName.toLowerCase() === 'html') {
       return null
   }
   var parentClassName = el.parentNode.getAttribute('class')
   var classNames = ''
   if (parentClassName) {
       classNames = parentClassName.split(' ')
   }
   if (classNames.indexOf(className) !== -1) {
       return el.parentNode
   }
   else {
       return faceOneGetParent(el.parentNode, className)
   }
}
Array.from(document.querySelectorAll('.face-one-nav-item-group-item')).forEach(function (node) {
    addAvativeClass(node)
    function addAvativeClass (node)  {
        if (node.href) {
            var pathname = node.href.replace(/\?.*/, '')
            if (pathname === location.origin + location.pathname + location.hash) {
                node.setAttribute('class', node.getAttribute('class') + ' ' + 'face-one-nav-item-group-item--on')
                var parentNode = faceOneGetParent(node, 'face-one-nav-item--group')
                if (parentNode) {
                    parentNode.setAttribute('class', parentNode.getAttribute('class') + ' ' + 'face-one-nav-item--group-on')
                }
            }
        }
    }

})
</script>
<div class="face-one-foot">
    <div class="face-one-foot-F-inner">
        <div class="face-one-foot-group">
            <div class="face-one-foot-group-title">
                <span class="face-one-foot-group-title-icon fi fi-github"></span>
                Github
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://github.com/onface/react-defaultvalue" class="face-one-foot-group-item-link">react-defaultvalue</a>
                - 项目源码
            </div>
        </div>
        <div class="face-one-foot-group">
            <div class="face-one-foot-group-title">
                <span class="face-one-foot-group-title-icon fi fi-link"></span>
                相关站点
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://github.com/onface/component-spec">component-spec</a>
                - 组件规范
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://github.com/onface/module" class="face-one-foot-group-item-link">module</a>
                - 开源项目脚手架
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://onface.live/" class="face-one-foot-group-item-link">onface.live</a>
                - 资源集合
            </div>
        </div>
        <div class="face-one-foot-group">
            <div class="face-one-foot-group-title">
                <span class="face-one-foot-group-title-icon fi fi-team"></span>
                社区
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://github.com/onface/react-defaultvalue/issues" class="face-one-foot-group-item-link">Github issues</a>
            </div>
            <div class="face-one-foot-group-item">
                <a href="https://github.com/onface/react-defaultvalue/issues/new" class="face-one-foot-group-item-link">提交bug</a>
            </div>
            <div class="face-one-foot-group-item" id="face-one-view-version">

            </div>

        </div>
        <div class="face-one-foot-copyright">
            <a href="../index.html" class="face-one-foot-copyright-title">
                <img src="theme/media/logo.svg" class="face-one-foot-copyright-title-logo" />
            </a>
        </div>
    </div>
</div>
<script>
PACKAGE_JSON = {
    name: "react-defaultvalue",
    $repository: "react-defaultvalue",
    version: "0.2.0",
}
</script>

<script src="theme/jquery.js"></script>
<script>delete window.$</script>
<script src="theme/face/face.js" ></script>
<script data-markrun-lastrun="true" src="intro-button.demo.js?v=0.2.0"></script><script data-markrun-lastrun="true" src="intro-defaultValue.demo.js?v=0.2.0"></script></body>
</html>